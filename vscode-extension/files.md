# VSCode Extension - File Reference

[Back to extension readme](readme.md) | [Back to main README](../README.md)

## Source Files (src/)

### extension.ts

**Purpose:** Extension entry point
**Exports:** `activate()`, `deactivate()`
**Lines:** 43

Initializes StateManager, StatusBarManager, registers commands, and sets up file watchers for state changes.

Key behaviors:
- Creates state manager and status bar on activation
- Watches `persona-state.json` for external changes
- Watches for workspace folder changes
- Logs activation/deactivation to console

---

### stateManager.ts

**Purpose:** Persona state persistence
**Class:** `StateManager`
**Lines:** 109

Reads/writes `~/.claude/persona-state.json`. Handles:
- Getting persona for current folder
- Setting persona for a folder
- Auto-detection logic based on project files
- Default persona management

Key types:
- `PersonaState` - Full state file structure
- `Persona` - Individual persona with name, displayName, icon
- `PERSONAS` - Constant array of available personas

---

### statusBar.ts

**Purpose:** Status bar UI management
**Class:** `StatusBarManager`
**Lines:** 45

Creates and updates the status bar item showing current persona. Displays:
- Icon + display name (e.g., "$(robot) TARS")
- Tooltip with click instruction
- "No Folder" when no workspace is open

Refreshes when:
- State file changes
- Workspace folders change
- User switches persona

---

### commands.ts

**Purpose:** VSCode command registration
**Function:** `registerCommands()`
**Lines:** 65

Registers two commands:
- `claudePersona.switch` - Quick pick to select persona, writes to state file
- `claudePersona.detect` - Auto-detects persona based on project files

Shows warning if no folder is open.

---

### vscodeApi.ts

**Purpose:** VSCode API abstraction
**Function:** `getVSCodeApi()`, `setVSCodeApi()`
**Lines:** 89

Wraps VSCode API calls to enable mocking in tests. Defines interfaces for:
- `StatusBarItem`
- `FileSystemWatcher`
- `WorkspaceFolder`
- `ExtensionContext`

Returns either real `vscode` module or mock implementation set via `setVSCodeApi()`.

---

## Build Output (out/)

Compiled JavaScript files mirror `src/` structure. Generated by `npm run compile`.

## Configuration

### package.json

Extension manifest defining:
- Name: `claude-persona-switcher`
- Version: `0.1.0`
- Activation: `onStartupFinished`
- Commands: `claudePersona.switch`, `claudePersona.detect`

### tsconfig.json

TypeScript configuration:
- Target: ES2020
- Module: CommonJS
- Strict mode enabled
- Source maps generated
